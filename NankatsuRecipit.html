<!DOCTYPE html>
<html>
<head>
  <title>南葛レシピ 東京聖栄大学</title>
  <script src="https://mozilla.github.io/pdf.js/build/pdf.js"></script>
  <style>
    #pdfContainer {
      height: calc(100vh - 40px);
      position: relative;
      flex: 1;
      overflow: hidden;
    }
    #controls {
      height: 40px;
      text-align: center;
      margin: 10px;
    }
    #mainContainer {
      display: flex;
      flex-direction: column;
      height: 100vh; /* Full viewport height */
    }
    canvas {
      display: none;
      margin: auto; /* Center canvas */
    }
  </style>
</head>
<body>

<div id="mainContainer">
  <div id="pdfContainer"></div>
  <div id="controls">
    <button id="prev">前</button>
    <input type="number" id="page-num" min="0">
    <button id="goToPage">ジャンプ</button>
    <button id="next">次</button>
  </div>
</div>

<script>
  var pdf;
  var pageNum = 0; // Start at 0
  var pdfContainer = document.getElementById('pdfContainer');

  // PDFファイルのURL
  var url = 'https://dl.dropboxusercontent.com/scl/fi/80egnc596fuhi2grnx86n/NankatsuRecipit.pdf?rlkey=r5r6vxmztj7t2uy70ot4tf5tv&dl=0';

  // pdf.jsの設定
  pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://mozilla.github.io/pdf.js/build/pdf.worker.js';

  function renderPage(pageNum) {
    return pdf.getPage(pageNum + 1).then(function(page) { // +1 because PDF.js starts pages at 1
      var viewport = page.getViewport({ scale: 1 });
      var scale = pdfContainer.clientHeight / viewport.height; // Focus only on height
      var scaledViewport = page.getViewport({ scale: scale });

      var canvas = document.createElement('canvas');
      canvas.id = 'canvas' + pageNum;
      canvas.height = scaledViewport.height;
      canvas.width = scaledViewport.width;
      pdfContainer.appendChild(canvas);

      var ctx = canvas.getContext('2d');
      var renderContext = {
        canvasContext: ctx,
        viewport: scaledViewport
      };

      return page.render(renderContext).promise;
    });
  }

  function loadPdf() {
    pdfContainer.innerHTML = "";
    var promises = [];

    for (var i = 0; i < Math.min(2, pdf.numPages); i++) {
      promises.push(renderPage(i));
    }

  // 最初の2ページが読み込まれた後に表示する
  Promise.all(promises).then(function() {
    document.getElementById('canvas' + pageNum).style.display = 'block';

    // 残りのページをバックグラウンドで読み込む
    for (var i = 2; i < pdf.numPages; i++) {
      renderPage(i);
    }
  });
}

  // PDFを読み込む
  pdfjsLib.getDocument(url).promise.then(function(_pdf) {
    pdf = _pdf;
    document.getElementById('page-num').max = pdf.numPages - 1; // -1 because we start at 0
    loadPdf(); // この関数を呼び出してPDFを読み込む
  });

  // ボタンでページ送り
  document.getElementById('prev').addEventListener('click', function() {
    if (pageNum > 0) {
      document.getElementById('canvas' + pageNum).style.display = 'none';
      pageNum--;
      document.getElementById('canvas' + pageNum).style.display = 'block';
      document.getElementById('page-num').value = pageNum;
    }
  });

  document.getElementById('next').addEventListener('click', function() {
    if (pageNum < pdf.numPages - 1) {
      document.getElementById('canvas' + pageNum).style.display = 'none';
      pageNum++;
      document.getElementById('canvas' + pageNum).style.display = 'block';
      document.getElementById('page-num').value = pageNum;
    }
  });

  // Goボタンでページジャンプ
  document.getElementById('goToPage').addEventListener('click', function() {
    var jumpTo = parseInt(document.getElementById('page-num').value, 10);
    if (jumpTo >= 0 && jumpTo < pdf.numPages) {
      document.getElementById('canvas' + pageNum).style.display = 'none';
      pageNum = jumpTo;
      document.getElementById('canvas' + pageNum).style.display = 'block';
    }
  });

  // リサイズ対応
  window.addEventListener('resize', loadPdf);
</script>
</body>
</html>
